{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 9, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/components/ParallelReader.module.scss [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"active\": \"ParallelReader-module-scss-module__rbxfja__active\",\n  \"buttonGroup\": \"ParallelReader-module-scss-module__rbxfja__buttonGroup\",\n  \"container\": \"ParallelReader-module-scss-module__rbxfja__container\",\n  \"controls\": \"ParallelReader-module-scss-module__rbxfja__controls\",\n  \"grid\": \"ParallelReader-module-scss-module__rbxfja__grid\",\n  \"header\": \"ParallelReader-module-scss-module__rbxfja__header\",\n  \"inactive\": \"ParallelReader-module-scss-module__rbxfja__inactive\",\n  \"inputWrapper\": \"ParallelReader-module-scss-module__rbxfja__inputWrapper\",\n  \"locked\": \"ParallelReader-module-scss-module__rbxfja__locked\",\n  \"panel\": \"ParallelReader-module-scss-module__rbxfja__panel\",\n  \"readerWrapper\": \"ParallelReader-module-scss-module__rbxfja__readerWrapper\",\n  \"syncButton\": \"ParallelReader-module-scss-module__rbxfja__syncButton\",\n  \"unlocked\": \"ParallelReader-module-scss-module__rbxfja__unlocked\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/mats/Code/react-parallel-reader/app/components/ParallelReader.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef } from 'react';\nimport { ReactReader } from 'react-reader';\nimport styles from './ParallelReader.module.scss';\n\n// Define a type for the location (can be a string CFI or integer 0)\ntype LocationType = string | number;\n\nexport default function ParallelReader() {\n    // --- State ---\n    const [urls, setUrls] = useState<string[]>(['/books/alice.epub', '/books/moby-dick.epub']);\n    const [count, setCount] = useState(2);\n    const [isLocked, setIsLocked] = useState(false);\n\n    // NEW: We must track the location of each book individually\n    const [locations, setLocations] = useState<LocationType[]>([0, 0, 0]);\n\n    const renditionRefs = useRef<(any | null)[]>([]);\n\n    // --- Handlers ---\n\n    const getRendition = (index: number, rendition: any) => {\n        renditionRefs.current[index] = rendition;\n\n        // Inject styles INSIDE the iframe (SASS cannot reach here)\n        rendition.themes.default({\n            'p': {\n                'font-family': 'Helvetica, sans-serif',\n                'font-size': '1.1rem',\n                'line-height': '1.6'\n            },\n            'div': { 'padding-bottom': '20px' }\n        });\n    };\n\n    const handleLocationChange = (index: number, newLocation: LocationType) => {\n        // 1. Update the state for THIS book so it doesn't get \"stuck\"\n        const newLocations = [...locations];\n        newLocations[index] = newLocation;\n        setLocations(newLocations);\n\n        // 2. The Sync Logic (If locked)\n        if (isLocked) {\n            // We need to access the \"internal\" epub location object to get percentage\n            // The 'newLocation' argument is just a CFI string, which isn't enough for math.\n            // So we ask the current rendition instance for its current percentage.\n            const currentRendition = renditionRefs.current[index];\n            const currentLocationObj = currentRendition?.location?.start;\n\n            const percentage = currentLocationObj?.percentage;\n\n            if (percentage >= 0) {\n                renditionRefs.current.forEach((ref, refIndex) => {\n                    // Sync everyone ELSE\n                    if (refIndex !== index && ref) {\n                        // We use .display(percentage) to jump them\n                        ref.display(percentage);\n\n                        // Note: We generally do NOT update the 'locations' state for the \n                        // passive books here to avoid race conditions. \n                        // We let the engine move them.\n                    }\n                });\n            }\n        }\n    };\n\n    const updateUrl = (index: number, newUrl: string) => {\n        const newUrls = [...urls];\n        newUrls[index] = newUrl;\n        setUrls(newUrls);\n    };\n\n    return (\n        <div className={styles.container}>\n            <div className={styles.header}>\n                <h1>Parallel Reader</h1>\n                <div className={styles.controls}>\n                    <div className={styles.buttonGroup}>\n                        {[1, 2, 3].map(num => (\n                            <button\n                                key={num}\n                                onClick={() => setCount(num)}\n                                className={count === num ? styles.active : styles.inactive}\n                            >\n                                {num} Panel{num > 1 && 's'}\n                            </button>\n                        ))}\n                    </div>\n                    <button\n                        onClick={() => setIsLocked(!isLocked)}\n                        className={`${styles.syncButton} ${isLocked ? styles.locked : styles.unlocked}`}\n                    >\n                        {isLocked ? 'ðŸ”“ Sync Locked' : 'ðŸ”’ Sync Unlocked'}\n                    </button>\n                </div>\n            </div>\n\n            <div className={styles.grid}>\n                {Array.from({ length: count }).map((_, index) => (\n                    <div\n                        key={index}\n                        className={styles.panel}\n                        style={{ maxWidth: `${100 / count}%` }}\n                    >\n                        <div className={styles.inputWrapper}>\n                            <input\n                                type=\"text\"\n                                placeholder=\"Paste EPUB URL here...\"\n                                value={urls[index] || ''}\n                                onChange={(e) => updateUrl(index, e.target.value)}\n                            />\n                        </div>\n\n                        <div className={styles.readerWrapper}>\n                            <ReactReader\n                                url={urls[index]}\n\n                                // REQUIRED PROP: Controls where the book is\n                                location={locations[index]}\n\n                                // REQUIRED PROP: Updates the state when user scrolls\n                                locationChanged={(loc) => handleLocationChange(index, loc)}\n\n                                getRendition={(rendition) => getRendition(index, rendition)}\n                                epubOptions={{\n                                    flow: \"scrolled\",\n                                    manager: \"continuous\",\n                                }}\n                            />\n                        </div>\n                    </div>\n                ))}\n            </div>\n        </div>\n    );\n}"],"names":[],"mappings":"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"}}]
}