{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/mats/Code/react-parallel-reader/app/hooks/useDebounce.ts"],"sourcesContent":["import { useEffect, useRef } from 'react';\n\nexport function useDebounce<T extends (...args: any[]) => void>(callback: T, delay: number) {\n    const timeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n    useEffect(() => {\n        // Cleanup the previous timeout on unmount\n        return () => {\n            if (timeoutRef.current) {\n                clearTimeout(timeoutRef.current);\n            }\n        };\n    }, []);\n\n    const debouncedCallback = (...args: Parameters<T>) => {\n        if (timeoutRef.current) {\n            clearTimeout(timeoutRef.current);\n        }\n\n        timeoutRef.current = setTimeout(() => {\n            callback(...args);\n        }, delay);\n    };\n\n    return debouncedCallback;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,YAAgD,QAAW,EAAE,KAAa;IACtF,MAAM,aAAa,IAAA,+MAAM,EAAwB;IAEjD,IAAA,kNAAS,EAAC;QACN,0CAA0C;QAC1C,OAAO;YACH,IAAI,WAAW,OAAO,EAAE;gBACpB,aAAa,WAAW,OAAO;YACnC;QACJ;IACJ,GAAG,EAAE;IAEL,MAAM,oBAAoB,CAAC,GAAG;QAC1B,IAAI,WAAW,OAAO,EAAE;YACpB,aAAa,WAAW,OAAO;QACnC;QAEA,WAAW,OAAO,GAAG,WAAW;YAC5B,YAAY;QAChB,GAAG;IACP;IAEA,OAAO;AACX"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/components/ParallelReader.module.scss [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"actions\": \"ParallelReader-module-scss-module__rbxfja__actions\",\n  \"active\": \"ParallelReader-module-scss-module__rbxfja__active\",\n  \"annotationCard\": \"ParallelReader-module-scss-module__rbxfja__annotationCard\",\n  \"buttonGroup\": \"ParallelReader-module-scss-module__rbxfja__buttonGroup\",\n  \"container\": \"ParallelReader-module-scss-module__rbxfja__container\",\n  \"controls\": \"ParallelReader-module-scss-module__rbxfja__controls\",\n  \"delete\": \"ParallelReader-module-scss-module__rbxfja__delete\",\n  \"emptyState\": \"ParallelReader-module-scss-module__rbxfja__emptyState\",\n  \"footer\": \"ParallelReader-module-scss-module__rbxfja__footer\",\n  \"grid\": \"ParallelReader-module-scss-module__rbxfja__grid\",\n  \"header\": \"ParallelReader-module-scss-module__rbxfja__header\",\n  \"inactive\": \"ParallelReader-module-scss-module__rbxfja__inactive\",\n  \"inputWrapper\": \"ParallelReader-module-scss-module__rbxfja__inputWrapper\",\n  \"jump\": \"ParallelReader-module-scss-module__rbxfja__jump\",\n  \"panel\": \"ParallelReader-module-scss-module__rbxfja__panel\",\n  \"readerWrapper\": \"ParallelReader-module-scss-module__rbxfja__readerWrapper\",\n  \"sidebar\": \"ParallelReader-module-scss-module__rbxfja__sidebar\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///Users/mats/Code/react-parallel-reader/app/components/ParallelReader.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { ReactReader, ReactReaderStyle } from 'react-reader';\nimport { useDebounce } from '../hooks/useDebounce';\nimport styles from './ParallelReader.module.scss';\nimport type { Rendition, Highlight } from '../../types/epub';\n\n// Define a type for the location (can be a string CFI or integer 0)\ntype LocationType = string | number;\n\ninterface ParallelReaderProps {\n    initialUrls: string[];\n    onBack?: () => void;\n}\n\nexport default function ParallelReader({ initialUrls, onBack }: ParallelReaderProps) {\n    // --- State ---\n    const [urls, setUrls] = useState<string[]>(initialUrls);\n    const [count, setCount] = useState(initialUrls.length || 2);\n    // NEW: We must track the location of each book individually\n    const [locations, setLocations] = useState<LocationType[]>(initialUrls.map(() => 0));\n\n    // Highlights State\n    const [highlights, setHighlights] = useState<Highlight[]>([]);\n    const [showHighlights, setShowHighlights] = useState(true);\n\n    // Styling State\n    const [showSettings, setShowSettings] = useState(false);\n    const [settings, setSettings] = useState({\n        fontSize: 100, // percentage\n        fontFamily: 'Helvetica, sans-serif',\n        lineHeight: 1.6\n    });\n\n\n\n    const renditionRefs = useRef<(Rendition | null)[]>([]);\n    // Track rendered highlights per panel to prevent duplicates\n    // Key: `${panelIndex}-${highlightId}`\n    const renderedRef = useRef<Set<string>>(new Set());\n\n    // Persistence: Hydrate locations from localStorage on mount\n    useEffect(() => {\n        try {\n            const saved = localStorage.getItem('parallel-reader-progress');\n            if (saved) {\n                const progress = JSON.parse(saved);\n\n                // Update locations based on URLs\n                // We map over current *urls* state to ensure we align with what's visible\n                const restoredLocations = urls.map((url, i) => {\n                    // if we have a saved location for this URL, use it\n                    if (progress[url]) return progress[url];\n                    // otherwise keep existing (which might be 0 or already set)\n                    return locations[i];\n                });\n\n                // Only update if different to avoid unnecessary re-renders?\n                // Initial locations are 0.\n                setLocations(restoredLocations);\n            }\n        } catch (e) {\n            console.error(\"Failed to load progress\", e);\n        }\n    }, []); // Run once on mount (window object available)\n\n    // Persistence: Save Logic\n    const saveProgress = (bookUrl: string, loc: LocationType) => {\n        try {\n            const saved = localStorage.getItem('parallel-reader-progress');\n            const progress = saved ? JSON.parse(saved) : {};\n\n            progress[bookUrl] = loc;\n            localStorage.setItem('parallel-reader-progress', JSON.stringify(progress));\n        } catch (e) {\n            console.error(\"Failed to save progress\", e);\n        }\n    };\n\n    const debouncedSave = useDebounce(saveProgress, 1000);\n\n    // Load highlights on mount or when URLs change\n    useEffect(() => {\n        if (urls.length > 0) {\n            const searchParams = new URLSearchParams();\n            searchParams.set('urls', urls.join(','));\n\n            fetch(`/api/highlights?${searchParams.toString()}`)\n                .then(res => res.json())\n                .then(data => setHighlights(data))\n                .catch(err => console.error(\"Error loading highlights:\", err));\n        }\n    }, [urls]);\n\n    // Style Injection Helper\n    const applyStyles = (rendition: Rendition) => {\n        rendition.themes.default({\n            'body': {\n                'font-family': `${settings.fontFamily} !important`,\n                'font-size': `${settings.fontSize}% !important`,\n                'line-height': `${settings.lineHeight} !important`\n            },\n            'p': {\n                'font-family': `${settings.fontFamily} !important`,\n                'font-size': `${settings.fontSize}% !important`,\n                'line-height': `${settings.lineHeight} !important`\n            },\n            'div': { 'padding-bottom': '20px' },\n            '::selection': {\n                'background': 'rgba(255, 255, 0, 0.3)'\n            },\n            '.hl-class': {\n                'fill': 'yellow',\n                'fill-opacity': '0.3',\n                'mix-blend-mode': 'multiply'\n            }\n        });\n    };\n\n    // Update active renditions when settings change\n    useEffect(() => {\n        renditionRefs.current.forEach(rendition => {\n            if (rendition) {\n                applyStyles(rendition);\n            }\n        });\n    }, [settings]);\n\n    // --- Handlers ---\n\n    const getRendition = (index: number, rendition: Rendition) => {\n        renditionRefs.current[index] = rendition;\n\n        // Initial styles\n        applyStyles(rendition);\n\n        // CLEANUP: Since a new rendition is created, our `renderedRef` for this panel is stale.\n        // We must clear it so we can re-add the highlights.\n        const keysToRemove: string[] = [];\n        renderedRef.current.forEach(key => {\n            if (key.startsWith(`${index}-`)) keysToRemove.push(key);\n        });\n        keysToRemove.forEach(k => renderedRef.current.delete(k));\n\n        // INITIAL RENDER: Apply existing highlights for this book\n        const bookHighlights = highlights.filter(h => h.bookUrl === urls[index]);\n        bookHighlights.forEach(h => {\n            rendition.annotations.add('highlight', h.cfiRange, {}, null, 'hl-class');\n            renderedRef.current.add(`${index}-${h.id}`);\n        });\n\n\n        // Listen for new selections\n        rendition.on('selected', (cfiRange: string, contents: any) => {\n            const range = rendition.getRange(cfiRange);\n            const text = range.toString();\n\n            // Persist\n            const newHighlight: Highlight = {\n                id: Date.now().toString(),\n                cfiRange,\n                text,\n                bookUrl: urls[index],\n                color: '#ffeb3b',\n                created: Date.now()\n            };\n\n            fetch('/api/highlights', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify(newHighlight)\n            }).then(res => res.json())\n                .then(() => {\n                    setHighlights(prev => [...prev, newHighlight]);\n                    // We rely on the useEffect to render this, OR we render it here and add to ref?\n                    // Ideally, let the effect handle it to keep logic central. \n                    // But for responsiveness, we often want instant feedback. \n                    // If we render here, we MUST add to renderedRef.\n                    rendition.annotations.add('highlight', cfiRange, {}, null, 'hl-class');\n                    renderedRef.current.add(`${index}-${newHighlight.id}`);\n\n                    // Clear selection to avoid visual clutter\n                    const selection = contents.window.getSelection();\n                    selection?.removeAllRanges();\n                });\n        });\n    };\n\n    // Re-apply highlights if they change (Diffing approach)\n    useEffect(() => {\n        renditionRefs.current.forEach((rendition, index) => {\n            if (!rendition) return;\n\n            const url = urls[index];\n            const bookHighlights = highlights.filter(h => h.bookUrl === url);\n            const bookHighlightIds = new Set(bookHighlights.map(h => h.id));\n\n            // 1. Add new highlights\n            bookHighlights.forEach(h => {\n                const key = `${index}-${h.id}`;\n                if (!renderedRef.current.has(key)) {\n                    rendition.annotations.add('highlight', h.cfiRange, {}, null, 'hl-class');\n                    renderedRef.current.add(key);\n                }\n            });\n\n            // 2. Remove deleted highlights\n            // We iterate effectively over all potentially rendered keys for this panel?\n            // Or simpler: iterate over the renderedRef and if it belongs to this panel AND is not in bookHighlightIds, remove it.\n            // This is slightly inefficient if we have thousands, but fine for now.\n            const keysToRemove: string[] = [];\n            renderedRef.current.forEach(key => {\n                const [pIdx, hId] = key.split('-');\n                if (parseInt(pIdx) === index) {\n                    if (!bookHighlightIds.has(hId)) {\n                        // Find the highlights to get the CFI?\n                        // Wait, we need the CFI to remove it! \n                        // epubjs rendition.annotations.remove(cfiRange, type)\n                        // If we don't have the feature in 'highlights', we might not know the CFI.\n                        // BUT: We usually deleted it via 'deleteHighlight' function which has access to it.\n\n                        // However, if we simply re-loaded or if updates came from elsewhere, we might have an issue.\n                        // For 'deleteHighlight' specifically, we handle removal there. \n                        // But to be purely reactive:\n                        // If we don't have the cfi, we can't remove via epubjs easily unless we stored it in the ref map (map<key, cfi>).\n\n                        keysToRemove.push(key);\n                    }\n                }\n            });\n\n            // Clean up the ref set for items we know are gone (e.g. removed via deleteHighlight)\n            keysToRemove.forEach(k => renderedRef.current.delete(k));\n\n        });\n    }, [highlights, urls]);\n\n\n    const handleLocationChange = (index: number, newLocation: LocationType) => {\n        // 1. Update the state for THIS book so it doesn't get \"stuck\"\n        const newLocations = [...locations];\n        newLocations[index] = newLocation;\n        setLocations(newLocations);\n\n        // 2. Persist\n        if (urls[index]) {\n            debouncedSave(urls[index], newLocation);\n        }\n    };\n\n    const updateUrl = (index: number, newUrl: string) => {\n        const newUrls = [...urls];\n        newUrls[index] = newUrl;\n        setUrls(newUrls);\n    };\n\n    const deleteHighlight = async (id: string, cfiRange: string, bookIndex: number) => {\n        // Optimistic update\n        setHighlights(prev => prev.filter(h => h.id !== id));\n\n        // Remove from rendition\n        const rendition = renditionRefs.current[bookIndex];\n        if (rendition) {\n            rendition.annotations.remove(cfiRange, 'highlight');\n            // Update ref\n            renderedRef.current.delete(`${bookIndex}-${id}`);\n        }\n\n        await fetch('/api/highlights', {\n            method: 'DELETE',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ id, bookUrl: urls[bookIndex] })\n        });\n    };\n\n    return (\n        <div className={styles.container}>\n            <div className={styles.header}>\n                <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\n                    {onBack && (\n                        <button\n                            onClick={onBack}\n                            className={styles.backButton}\n                            style={{\n                                background: 'none', border: 'none', cursor: 'pointer', fontSize: '1.2rem'\n                            }}\n                        >\n                            ← Back\n                        </button>\n                    )}\n                    <h1>Parallel Reader</h1>\n                </div>\n                <div className={styles.controls}>\n                    {/* Settings Toggle */}\n                    <button\n                        onClick={() => setShowSettings(!showSettings)}\n                        style={{ border: 'none', background: 'none', cursor: 'pointer', fontSize: '1.2rem', marginRight: '0.5rem' }}\n                        title=\"Display Settings\"\n                    >\n                        ⚙️\n                    </button>\n\n                    {/* Settings Panel */}\n                    {showSettings && (\n                        <div className={styles.settingsPanel}>\n                            <h3>Display Settings</h3>\n                            <div className={styles.settingGroup}>\n                                <div className={styles.rangeValue}>\n                                    <label>Font Size</label>\n                                    <span>{settings.fontSize}%</span>\n                                </div>\n                                <input\n                                    type=\"range\"\n                                    min=\"80\"\n                                    max=\"200\"\n                                    step=\"10\"\n                                    value={settings.fontSize}\n                                    onChange={(e) => setSettings({ ...settings, fontSize: Number(e.target.value) })}\n                                />\n                            </div>\n                            <div className={styles.settingGroup}>\n                                <label>Font Family</label>\n                                <select\n                                    value={settings.fontFamily}\n                                    onChange={(e) => setSettings({ ...settings, fontFamily: e.target.value })}\n                                >\n                                    <option value=\"Helvetica, sans-serif\">Helvetica</option>\n                                    <option value=\"Georgia, serif\">Georgia</option>\n                                    <option value=\"Courier New, monospace\">Monospace</option>\n                                </select>\n                            </div>\n                            <div className={styles.settingGroup}>\n                                <label>Line Height</label>\n                                <select\n                                    value={settings.lineHeight}\n                                    onChange={(e) => setSettings({ ...settings, lineHeight: Number(e.target.value) })}\n                                >\n                                    <option value={1.2}>Compact (1.2)</option>\n                                    <option value={1.6}>Normal (1.6)</option>\n                                    <option value={2.0}>Loose (2.0)</option>\n                                </select>\n                            </div>\n                        </div>\n                    )}\n\n                    <div className={styles.buttonGroup}>\n                        <button\n                            onClick={() => setShowHighlights(!showHighlights)}\n                            className={showHighlights ? styles.active : styles.inactive}\n                        >\n                            {showHighlights ? 'Hide Notes' : 'Show Notes'}\n                        </button>\n                    </div>\n\n                    <div className={styles.buttonGroup}>\n                        {[1, 2, 3].map(num => (\n                            <button\n                                key={num}\n                                onClick={() => setCount(num)}\n                                className={count === num ? styles.active : styles.inactive}\n                            >\n                                {num} Panel{num > 1 && 's'}\n                            </button>\n                        ))}\n                    </div>\n                </div>\n            </div>\n\n            <div style={{ display: 'flex', flex: 1, overflow: 'hidden' }}>\n                {/* Main Reader Grid */}\n                <div className={styles.grid} style={{ flex: showHighlights ? '0 0 75%' : '1' }}>\n                    {Array.from({ length: count }).map((_, index) => (\n                        <div\n                            key={index}\n                            className={styles.panel}\n                            style={{ maxWidth: `${100 / count}%` }}\n                        >\n                            <div className={styles.inputWrapper}>\n                                <input\n                                    type=\"text\"\n                                    placeholder=\"Paste EPUB URL here...\"\n                                    value={urls[index] || ''}\n                                    onChange={(e) => updateUrl(index, e.target.value)}\n                                />\n                            </div>\n\n                            <div className={styles.readerWrapper}>\n                                <ReactReader\n                                    url={urls[index]}\n\n                                    // REQUIRED PROP: Controls where the book is\n                                    location={locations[index] || 0}\n\n                                    // REQUIRED PROP: Updates the state when user scrolls\n                                    locationChanged={(loc) => handleLocationChange(index, loc)}\n\n                                    getRendition={(rendition) => getRendition(index, rendition)}\n                                    epubOptions={{\n                                        flow: \"scrolled\",\n                                        manager: \"continuous\",\n                                    }}\n                                    swipeable={false}\n                                    readerStyles={{\n                                        ...ReactReaderStyle,\n                                        arrow: {\n                                            ...ReactReaderStyle.arrow,\n                                            display: 'none',\n                                        }\n                                    }}\n                                />\n                            </div>\n                        </div>\n                    ))}\n                </div>\n\n                {/* Highlights Sidebar */}\n                {showHighlights && (\n                    <div className={styles.sidebar}>\n                        <h2>Annotations</h2>\n                        {highlights.length === 0 && <p className={styles.emptyState}>Select text to highlight.</p>}\n\n                        {highlights.map(h => (\n                            <div key={h.id} className={styles.annotationCard}>\n                                <p>\"{h.text}\"</p>\n                                <div className={styles.footer}>\n                                    <span>\n                                        {/* Try to find which book this belongs to for display */}\n                                        {urls.findIndex(u => u === h.bookUrl) > -1 ? `Panel ${urls.findIndex(u => u === h.bookUrl) + 1}` : 'Other Book'}\n                                    </span>\n                                    <div className={styles.actions}>\n                                        <button\n                                            className={styles.jump}\n                                            onClick={() => {\n                                                const idx = urls.indexOf(h.bookUrl);\n                                                if (idx !== -1 && renditionRefs.current[idx]) {\n                                                    renditionRefs.current[idx]?.display(h.cfiRange);\n                                                }\n                                            }}\n                                        >\n                                            Jump\n                                        </button>\n                                        <button\n                                            className={styles.delete}\n                                            onClick={() => deleteHighlight(h.id, h.cfiRange, urls.indexOf(h.bookUrl))}\n                                        >\n                                            Delete\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </div>\n        </div>\n    );\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 785, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/app/components/Bookshelf.module.scss [app-ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"arrow\": \"Bookshelf-module-scss-module__3Di2QW__arrow\",\n  \"bookCount\": \"Bookshelf-module-scss-module__3Di2QW__bookCount\",\n  \"card\": \"Bookshelf-module-scss-module__3Di2QW__card\",\n  \"cardContent\": \"Bookshelf-module-scss-module__3Di2QW__cardContent\",\n  \"collectionName\": \"Bookshelf-module-scss-module__3Di2QW__collectionName\",\n  \"container\": \"Bookshelf-module-scss-module__3Di2QW__container\",\n  \"emptyState\": \"Bookshelf-module-scss-module__3Di2QW__emptyState\",\n  \"list\": \"Bookshelf-module-scss-module__3Di2QW__list\",\n  \"loading\": \"Bookshelf-module-scss-module__3Di2QW__loading\",\n  \"subtitle\": \"Bookshelf-module-scss-module__3Di2QW__subtitle\",\n  \"title\": \"Bookshelf-module-scss-module__3Di2QW__title\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 802, "column": 0}, "map": {"version":3,"sources":["file:///Users/mats/Code/react-parallel-reader/app/components/Bookshelf.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState } from 'react';\nimport type { BookCollection } from '../../types/epub';\nimport styles from './Bookshelf.module.scss';\n\ninterface BookshelfProps {\n    onSelectCollection: (files: string[]) => void;\n}\n\nexport default function Bookshelf({ onSelectCollection }: BookshelfProps) {\n    const [collections, setCollections] = useState<BookCollection[]>([]);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        fetch('/api/books')\n            .then((res) => res.json())\n            .then((data) => {\n                setCollections(data);\n                setLoading(false);\n            })\n            .catch((err) => {\n                console.error('Failed to load books:', err);\n                setLoading(false);\n            });\n    }, []);\n\n    if (loading) return <div className={styles.loading}>Loading library...</div>;\n\n    return (\n        <div className={styles.container}>\n            <h1 className={styles.title}>My Collections</h1>\n\n            {collections.length === 0 ? (\n                <div className={styles.emptyState}>\n                    <p>No collections found in <code>public/books/</code>.</p>\n                    <p className={styles.subtitle}>Create a subfolder (e.g., <code>public/books/classics/</code>) and add EPUB files to start.</p>\n                </div>\n            ) : (\n                <div className={styles.list}>\n                    {collections.map((collection) => (\n                        <div\n                            key={collection.name}\n                            className={styles.card}\n                            onClick={() => onSelectCollection(collection.files)}\n                        >\n                            <div className={styles.cardContent}>\n                                <div>\n                                    <h3 className={styles.collectionName}>\n                                        {collection.name.replace(/-/g, ' ')}\n                                    </h3>\n                                    <p className={styles.bookCount}>\n                                        {collection.files.length} book{collection.files.length !== 1 && 's'}\n                                    </p>\n                                </div>\n                                <div className={styles.arrow}>\n                                    <span style={{ fontSize: '1.5rem' }}>→</span>\n                                </div>\n                            </div>\n                        </div>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAEA;AAJA;;;;AAUe,SAAS,UAAU,EAAE,kBAAkB,EAAkB;IACpE,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAmB,EAAE;IACnE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,IAAA,kNAAS,EAAC;QACN,MAAM,cACD,IAAI,CAAC,CAAC,MAAQ,IAAI,IAAI,IACtB,IAAI,CAAC,CAAC;YACH,eAAe;YACf,WAAW;QACf,GACC,KAAK,CAAC,CAAC;YACJ,QAAQ,KAAK,CAAC,yBAAyB;YACvC,WAAW;QACf;IACR,GAAG,EAAE;IAEL,IAAI,SAAS,qBAAO,8OAAC;QAAI,WAAW,sJAAM,CAAC,OAAO;kBAAE;;;;;;IAEpD,qBACI,8OAAC;QAAI,WAAW,sJAAM,CAAC,SAAS;;0BAC5B,8OAAC;gBAAG,WAAW,sJAAM,CAAC,KAAK;0BAAE;;;;;;YAE5B,YAAY,MAAM,KAAK,kBACpB,8OAAC;gBAAI,WAAW,sJAAM,CAAC,UAAU;;kCAC7B,8OAAC;;4BAAE;0CAAwB,8OAAC;0CAAK;;;;;;4BAAoB;;;;;;;kCACrD,8OAAC;wBAAE,WAAW,sJAAM,CAAC,QAAQ;;4BAAE;0CAA0B,8OAAC;0CAAK;;;;;;4BAA6B;;;;;;;;;;;;qCAGhG,8OAAC;gBAAI,WAAW,sJAAM,CAAC,IAAI;0BACtB,YAAY,GAAG,CAAC,CAAC,2BACd,8OAAC;wBAEG,WAAW,sJAAM,CAAC,IAAI;wBACtB,SAAS,IAAM,mBAAmB,WAAW,KAAK;kCAElD,cAAA,8OAAC;4BAAI,WAAW,sJAAM,CAAC,WAAW;;8CAC9B,8OAAC;;sDACG,8OAAC;4CAAG,WAAW,sJAAM,CAAC,cAAc;sDAC/B,WAAW,IAAI,CAAC,OAAO,CAAC,MAAM;;;;;;sDAEnC,8OAAC;4CAAE,WAAW,sJAAM,CAAC,SAAS;;gDACzB,WAAW,KAAK,CAAC,MAAM;gDAAC;gDAAM,WAAW,KAAK,CAAC,MAAM,KAAK,KAAK;;;;;;;;;;;;;8CAGxE,8OAAC;oCAAI,WAAW,sJAAM,CAAC,KAAK;8CACxB,cAAA,8OAAC;wCAAK,OAAO;4CAAE,UAAU;wCAAS;kDAAG;;;;;;;;;;;;;;;;;uBAdxC,WAAW,IAAI;;;;;;;;;;;;;;;;AAuBhD"}},
    {"offset": {"line": 967, "column": 0}, "map": {"version":3,"sources":["file:///Users/mats/Code/react-parallel-reader/app/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from \"react\";\nimport ParallelReader from \"./components/ParallelReader\";\nimport Bookshelf from \"./components/Bookshelf\";\n\nexport default function Home() {\n  const [selectedBooks, setSelectedBooks] = useState<string[] | null>(null);\n\n  return (\n    <main className=\"min-h-screen bg-gray-50\">\n      {selectedBooks ? (\n        <ParallelReader\n          initialUrls={selectedBooks}\n          onBack={() => setSelectedBooks(null)}\n        />\n      ) : (\n        <Bookshelf onSelectCollection={setSelectedBooks} />\n      )}\n    </main>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS;IACtB,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAkB;IAEpE,qBACE,8OAAC;QAAK,WAAU;kBACb,8BACC,8OAAC,+IAAc;YACb,aAAa;YACb,QAAQ,IAAM,iBAAiB;;;;;iCAGjC,8OAAC,0IAAS;YAAC,oBAAoB;;;;;;;;;;;AAIvC"}}]
}